<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Undercover (3 √† 10 joueurs) - Smartphone</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:12px;background:#f6f6f6}
    h1{font-size:18px;margin:0 0 10px}
    .panel{background:#fff;border:1px solid #ddd;border-radius:12px;padding:12px;margin:10px 0}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    button{padding:10px 12px;border:0;border-radius:10px;background:#111;color:#fff;font-weight:700}
    button.secondary{background:#e9e9e9;color:#111}
    input,select{padding:10px;border-radius:10px;border:1px solid #ddd;background:#fff}
    .pill{border:1px solid #ddd;background:#fff;border-radius:999px;padding:6px 10px;font-size:13px}
    .big{font-size:22px;font-weight:900}
    .muted{opacity:.75}
    .list{display:grid;gap:8px}
    .card{border:1px solid #ddd;border-radius:12px;background:#fafafa;padding:10px;cursor:pointer}
    .dead{opacity:.55;text-decoration:line-through}
  </style>
</head>
<body>
<h1>üïµÔ∏è Undercover ‚Äî 3 √† 10 joueurs (Mr White devine)</h1>

<div class="panel" id="setup">
  <div class="row">
    <div>
      <div class="muted">Joueurs (3‚Äì10)</div>
      <input id="nPlayers" type="number" min="3" max="10" value="8"/>
    </div>
    <div>
      <div class="muted">Undercover</div>
      <input id="nUnder" type="number" min="1" max="4" value="2"/>
    </div>
    <div>
      <div class="muted">Mr White</div>
      <input id="nWhite" type="number" min="0" max="1" value="1"/>
    </div>
  </div>

  <div class="panel" style="background:#fafafa">
    <div class="muted">Paire de mots (proches)</div>
    <div class="row" style="margin-top:8px">
      <input id="wordA" placeholder="Mot des civils" value="Plage" />
      <input id="wordB" placeholder="Mot des undercover" value="Piscine" />
    </div>
    <div class="muted" style="margin-top:8px;font-size:13px">
      Astuce : choisis des mots proches (ex : ‚ÄúPlage / Piscine‚Äù, ‚ÄúPizza / Quiche‚Äù‚Ä¶)
    </div>
  </div>

  <div class="row" style="margin-top:10px">
    <button onclick="start()">D√©marrer</button>
    <button class="secondary" onclick="randomPair()">Mots au hasard</button>
    <button class="secondary" onclick="autoConfig()">Auto config</button>
    <span class="pill" id="setupHint"></span>
  </div>
</div>

<div class="panel" id="reveal" style="display:none">
  <div class="row" style="justify-content:space-between">
    <div class="pill"><b>Joueur</b> <span id="pIndex"></span>/<span id="pTotal"></span></div>
    <button class="secondary" onclick="hide()">Cacher</button>
  </div>

  <div style="margin-top:10px" class="big" id="roleLine">‚Äî</div>
  <div class="muted" id="wordLine" style="margin-top:6px"></div>

  <div class="row" style="margin-top:12px">
    <button onclick="show()">Voir</button>
    <button class="secondary" onclick="next()">Joueur suivant</button>
  </div>
</div>

<div class="panel" id="game" style="display:none">
  <div class="row" style="justify-content:space-between">
    <div class="pill"><b>Manche :</b> <span id="round">1</span></div>
    <div class="pill"><b>√âtat :</b> <span id="status">Discussion</span></div>
  </div>

  <div class="panel" style="background:#fafafa">
    <div class="big" id="phaseTitle">üó£Ô∏è Discussion</div>
    <div class="muted" id="phaseText" style="margin-top:6px">
      Chacun donne un indice (un mot/une courte phrase). Puis votez pour √©liminer quelqu‚Äôun.
    </div>
    <div class="row" style="margin-top:10px">
      <button onclick="toVote()">Passer au vote</button>
      <button class="secondary" onclick="newRound()">Nouvelle manche</button>
      <button class="secondary" onclick="restart()">Recommencer</button>
    </div>
  </div>

  <div class="panel">
    <div class="row" style="justify-content:space-between">
      <b>Joueurs (tape pour √©liminer / r√©animer)</b>
      <span class="muted">‚úÖ vivant / ‚ò†Ô∏è √©limin√©</span>
    </div>
    <div class="list" id="playersList" style="margin-top:10px"></div>
  </div>
</div>

<script>
let S=null;

const PAIRS = [
  ["Plage","Piscine"], ["Boulangerie","P√¢tisserie"], ["Chat","Chien"],
  ["For√™t","Jungle"], ["Avion","H√©licopt√®re"], ["Pizza","Quiche"],
  ["Football","Rugby"], ["Cin√©ma","Th√©√¢tre"], ["Montagne","Colline"],
  ["Caf√©","Th√©"], ["Voiture","Moto"], ["Livre","Magazine"],
  ["Hiver","No√´l"], ["Sapin","Guirlande"], ["Neige","Glace"],
];

function randomPair(){
  const [a,b]=PAIRS[Math.floor(Math.random()*PAIRS.length)];
  document.getElementById("wordA").value=a;
  document.getElementById("wordB").value=b;
  document.getElementById("setupHint").textContent=`Paire : ${a} / ${b}`;
}

function autoConfig(){
  const n = clamp(+document.getElementById("nPlayers").value, 3, 10);
  let u=1,w=0;
  if(n===3){ u=1; w=0; }
  else if(n<=5){ u=1; w=1; }
  else if(n<=7){ u=2; w=1; }
  else { u=3; w=1; }
  document.getElementById("nUnder").value=u;
  document.getElementById("nWhite").value=w;
  document.getElementById("setupHint").textContent=`Auto : ${u} Undercover, ${w} Mr White pour ${n} joueurs.`;
}

function start(){
  const n = clamp(+document.getElementById("nPlayers").value, 3, 10);
  let u = clamp(+document.getElementById("nUnder").value, 1, 4);
  let w = clamp(+document.getElementById("nWhite").value, 0, 1);
  const A = (document.getElementById("wordA").value||"").trim();
  const B = (document.getElementById("wordB").value||"").trim();

  if(!A || !B || A.toLowerCase()===B.toLowerCase()){
    alert("Choisis 2 mots diff√©rents.");
    return;
  }
  if(u + w >= n){
    alert("Trop d‚Äôimposteurs : il faut au moins 1 civil üôÇ");
    return;
  }
  if(n===3 && w===1){
    alert("√Ä 3 joueurs, √©vite Mr White (trop dur). Clique Auto config üôÇ");
    return;
  }

  const roles=[];
  for(let i=0;i<u;i++) roles.push({role:"Undercover", word:B});
  for(let i=0;i<w;i++) roles.push({role:"Mr White", word:"(aucun mot)"});
  while(roles.length<n) roles.push({role:"Civil", word:A});
  shuffle(roles);

  S={ n,u,w,A,B,roles,player:0,revealed:false,alive:Array.from({length:n},()=>true),round:1,status:"Discussion", gameOver:false };

  document.getElementById("setup").style.display="none";
  document.getElementById("reveal").style.display="block";
  document.getElementById("pTotal").textContent=n;
  document.getElementById("setupHint").textContent="";
  updateReveal();
}

function updateReveal(){ document.getElementById("pIndex").textContent=S.player+1; hide(); }

function show(){
  const r=S.roles[S.player];
  document.getElementById("roleLine").textContent =
    r.role==="Civil" ? "üôÇ Civil" : (r.role==="Undercover" ? "üï∂Ô∏è Undercover" : "‚¨ú Mr White");
  document.getElementById("wordLine").textContent =
    r.role==="Mr White" ? "Tu n‚Äôas PAS de mot. Si tu es √©limin√©, tu devras deviner le mot des civils."
                        : `Ton mot : ${r.word}`;
  S.revealed=true;
}

function hide(){
  document.getElementById("roleLine").textContent="‚Äî";
  document.getElementById("wordLine").textContent="Passe le t√©l√©phone au joueur, puis appuie sur ‚ÄúVoir‚Äù.";
  S.revealed=false;
}

function next(){
  if(S.player < S.n-1){ S.player++; updateReveal(); }
  else {
    document.getElementById("reveal").style.display="none";
    document.getElementById("game").style.display="block";
    renderPlayers();
  }
}

function normalize(s){
  return (s||"").trim().toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,""); // enl√®ve accents
}

function eliminatePlayer(i){
  if(S.gameOver) return;
  if(!S.alive[i]) return;

  S.alive[i]=false;

  const role = S.roles[i].role;

  // Si Mr White est √©limin√© : il tente de deviner le mot des civils
  if(role==="Mr White"){
    const guess = prompt("‚¨ú Mr White √©limin√© ! Devine le mot des civils :");
    if(guess != null){
      if(normalize(guess) === normalize(S.A)){
        alert("üéâ Mr White a devin√© ! Mr White gagne instantan√©ment !");
        S.gameOver=true;
        revealAll();
        return;
      } else {
        alert("‚ùå Mauvaise r√©ponse. Mr White est √©limin√©.");
      }
    } else {
      alert("Mr White ne tente pas / annule. Il est √©limin√©.");
    }
  }

  renderPlayers();
  checkWin();
}

function renderPlayers(){
  const list=document.getElementById("playersList");
  list.innerHTML="";
  for(let i=0;i<S.n;i++){
    const div=document.createElement("div");
    div.className="card" + (S.alive[i] ? "" : " dead");
    div.innerHTML=`<b>Joueur ${i+1}</b> ‚Äî ${S.alive[i] ? "‚úÖ vivant" : "‚ò†Ô∏è √©limin√©"}`;
    div.onclick=()=>{
      // tap = toggle. Si vivant -> on √©limine (et d√©clenche Mr White si besoin)
      if(S.alive[i]) eliminatePlayer(i);
      else { S.alive[i]=true; renderPlayers(); } // r√©animer si erreur
    };
    list.appendChild(div);
  }
  document.getElementById("round").textContent=S.round;
  document.getElementById("status").textContent=S.status;
}

function toVote(){
  if(S.gameOver) return;
  S.status="Vote";
  document.getElementById("phaseTitle").textContent="üó≥Ô∏è Vote";
  document.getElementById("phaseText").textContent="Votez, puis tape sur le joueur √©limin√© dans la liste.";
  renderPlayers();
}

function newRound(){
  if(S.gameOver) return;
  S.round++;
  S.status="Discussion";
  document.getElementById("phaseTitle").textContent="üó£Ô∏è Discussion";
  document.getElementById("phaseText").textContent="Chacun donne un indice. Puis votez pour √©liminer quelqu‚Äôun.";
  renderPlayers();
}

function checkWin(){
  if(S.gameOver) return;

  let aliveC=0, aliveU=0, aliveW=0;
  for(let i=0;i<S.n;i++){
    if(!S.alive[i]) continue;
    const r=S.roles[i].role;
    if(r==="Civil") aliveC++;
    if(r==="Undercover") aliveU++;
    if(r==="Mr White") aliveW++;
  }

  if(aliveU+aliveW===0){
    alert("üéâ Les civils gagnent !");
    S.gameOver=true;
    revealAll(); return;
  }
  if(aliveU+aliveW>=aliveC){
    alert("üíÄ Les imposteurs gagnent !");
    S.gameOver=true;
    revealAll(); return;
  }
}

function revealAll(){
  alert("R√©v√©lation :\n\n" + S.roles.map((r,i)=>`Joueur ${i+1}: ${r.role} ‚Äî ${r.word}`).join("\n") +
        `\n\nMot civils: ${S.A}\nMot undercover: ${S.B}`);
}

function restart(){ location.reload(); }

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
function clamp(x,min,max){ return Math.max(min, Math.min(max, x)); }
</script>
</body>
</html>
